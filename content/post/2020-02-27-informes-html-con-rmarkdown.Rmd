---
title: informes html con Rmarkdown
author: F.VilBer
date: '2020-02-27'
slug: informes-html-con-rmarkdown
draft: true
categories:
  - diseño
  - editar documentos
  - markdown
  - R
tags:
  - sintaxis
  - markdown
description: ''
thumbnail: ''
---

Hace tiempo que quería escribir un resumen de trucos o ayudas rápidas para hacer informes en formato web (HTML) usando RSTUDIO con Rmarkdown. No se trata de explicar *Rmarkdown*, para eso hay cientos de manuales muy completos como  [este](https://bookdown.org/yihui/rmarkdown/html-document.html), solo dar algunas pinceladas de cosas que a mi me resultan útiles en los informes.

¡Vamos con materia!

## Formato YAML
Siempre que empezamos un documento *Rmarkdown* nuevo, el formato general y el tipo de salida la definimos con el encabezado *YAML*. Aquí las opciones son muchísimas, ten en cuenta que con Rmarkdown puedes hacer muchos tipos de [salidas diferentes](https://rmarkdown.rstudio.com/formats.html){:target="_blank" rel="noopener"} (pdf, html, presentaciones, páginas web, libros, websites, ODT...). 

![markdown proceso](/post/2020-02-27-informes-html-con-rmarkdown_files/rmarkdown_elementos.png)


Si nos centramos en el tipo HTML, lo que hacemos es elegir como salida `output:` el formato `html_document:`. A partir de aquí, definimos en el metadata del *YAML* las características generales. Las voy comentando en el código siguiente, pues son muchas y lo normal es poner solo las que quieras y comentar con `#` o borrar el resto de líneas:

````markdown
---
title: 'informe HTML'
author: 'Autor: Ferran'
subtitle: 'qué grande es R' 
date: 
output: 
  html_document:          # la salida predefinida es html 
# ver/ocultar los trozos de código  
    #code_download: true  # si incluimos un botón para bajar el código o no
    #code_folding: hide   # para mostrar o esconder los chunk de codigo 
# tabla de contenido
    #number_sections: yes   # numera los titulos
    toc: TRUE               # incluye o no el indice
    toc_float: TRUE         # incluye o no indice flotante
      #collapsed: false      # que se escondan los tit
      #smooth_scroll: false  # scroll en TOC
# formato  estilo    
    theme: "spacelab"    # especifica el tema Bootstrap
    highlight: kate      # resaltado de sintaxis
    #self_contained: false    # salida fichero autocontenido
# formato de figuras
    fig_width: 7         # ancho de las figuras por defecto
    fig_height: 6        # alto de las figuras
    fig_caption: true    # titulo de figura
---
````

El formato general se da con las opciones `theme:` y `highlight:` que aportan la apariencia final y el resaltado de sintaxis. Ambas provienen de una librería libre de estilos llamada  *Bootstrap*.
Los estilos incluidos por defecto son los siguientes:

 * `theme:` default, cerulean, journal, flatly, darkly, readable, spacelab, united, cosmo, lumen, paper, sandstone, simplex, yeti
 * `highlight:` default, tango, pygments, kate, monochrome, espresso, zenburn, haddock, breezedark,  textmate
 
 Para usar un estilo propio hay que dar la ruta (local) del fichero de estilo `css: fichero_estilo_propio.css` y poner a `null` ambas características anteriores. 

Por defecto RMarkdown crea un unico fichero de salida que guarda internamiente todo (incluido imágenes..) esto no es el formato habitual de un HTML, y en algún caso si quieres guardar los links a los origenes de documentos (imagenes, videos etc..) quizás es mejor que uses `self_contained: false`, pero acuerdate que en este caso no solo debes mandar el fichero *html*, sino todas las dependencias. Incluso al usar  esto , algunas librerías de formato como Bootstrap, y MathJax no se guardan en el fichero unico ya que ocupan mucho espacio. Si las quieres incluir hay que guardarlas en local para lo que se puede añadir `lib_dir: libs` y guardar en la carpeta *libs* las dependiencias. 

## quitar mensajes de innecesarios
Siempre es mejor poner una par de lineas de código para evitar llenar el informe de salidas innecesaias, como avisos, mensajes de error, y esas cosas. Basta con añadir debajo del encabezado YAML esto:

````markdown
```r '{r setup, include=FALSE}'` 
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```
````
## Insertar imágenes 

Insertar una imágen en markdown es fácil, basta con incluir un código así:

````markdown
![titulo imagen](/ruta/a_la/imagen.jpg)
````
Si quieres un formato mas completo en la salida debes usar código R. En mi caso uso mucho la función `include_graphics()` de la librería `knitr`, ya que da más opciones, por ejemplo así: 

````markdown
````r '{r pressure, echo=FALSE, fig.cap="A caption", out.width = "100%" }'`
knitr::include_graphics("temp.png")
```
````
La ventaja es que puedes controlar el tamaño de la imganen simplemente con el porcentaje. Si quieras insertar 2 fotos por línea solo tienes que poner en el inicio del chunk `out.width = '50%'`. 

Y como metes código puedes hacer cosas como leer un directorio completo donde has dejado las imagenes y buscar algunas para sacarlas en el informe, por ejemplo así:

```{r eval=FALSE, out.width = '50%' }
  library(knitr)
    ruta<-"img/"  # meto la ruta del directorio
    # busco en ese dir imagenes jpg..
    imagenes<-list.files(ruta, pattern = ".jpg", full.names = TRUE )
    
    #list.files("img/", pattern = "*[0-9].jpg", full.names = TRUE ) # las que terminan en número
    # las imprimo o saco en el doc final
    include_graphics(imagenes)
```

Otra opcion diferente es escribir código html directamente, ya que markdown lo reconoce, así si escibes esto, sale la imagen siguiente:

```YAML
<div id="bg">
  <img src="/img/vis_art/predictions - sillas.jpg" alt="">
</div> 
```
<div id="bg">
  <img src="/img/vis_art/predictions - sillas.jpg" alt="">
</div> 

## insertar imagene en el header
Esto es una curiosidad, pero a mi me gusta poner un logo o imagen al inicio del informe, o de encabezado. Hay varias formas de hacerlo pero la más sencilla es así, poniendo este script

```YAML 
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"LogoenRdados48.png\" style=\"float: right;width: 150px;\"/>')
   });
</script>
```
o incluyendo un head
```YAML 
---
title: "Test"
author: "Martin Schmelzer"
date: "13 Juli 2016"
output: 
  html_document:
    includes:
      in_header: encabezado.html
---
```

## insertar tablas

```{r table}
knitr::kable(mtcars[1:5,, 1:5], caption = "A table caption")
```

Para dar formatos a las tablas podemos usar tambien la extensión `kableExtra`.

````markdown
## pestañas {.tabset}

Algo muy util es usar pestañas.

### tabla

````r '{r}'`
knitr::kable(mtcars[1:5,, 1:5], caption = "A table caption")
```
### Gráficos

````r '{r}'`
hist(rnorm(125), col="red")
```
````

## conclusiones

estoi es el fin por hoy